atlas
1614881927 | HILICz150_ANT20190824_PRD_EMA_Unlab_POS_20201116_506489_WHv1 


select DISTINCT creation_time, hdf5_file from lcmsruns WHERE hdf5_file LIKE '%_506489_%POS%Heated%organic%' and hdf5_file not LIKE '%pilot%' ORD
ER BY creation_time LIMIT 4;

|    1606776028 | /project/projectdirs/metatlas/raw_data/akuftin/20201116_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530/20201117_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530_POS_MSMS_76-PS-73_Heated-organic-soil-Oct-28y_E_Rg70to1050-CE205060-WaterExt-S1_Run258.h5  |
|    1606776028 | /project/projectdirs/metatlas/raw_data/akuftin/20201116_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530/20201117_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530_POS_MSMS_80-PS-77_Heated-organic-soil-Oct-13y_D_Rg70to1050-CE205060-WaterExt-S1_Run197.h5  |
|    1606776028 | /project/projectdirs/metatlas/raw_data/akuftin/20201116_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530/20201117_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530_POS_MSMS_83-PS-80_Heated-organic-soil-Oct-13y_E_Rg70to1050-CE205060-WaterExt-S1_Run264.h5  |
|    1606776029 | /project/projectdirs/metatlas/raw_data/akuftin/20201116_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530/20201117_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530_POS_MSMS_35-PS-35_Heated-organic-soil-July-13y_E_Rg70to1050-CE205060-WaterExt-S1_Run243.h5 |



mutable MYSQL commands executed:
DELETE FROM atlases where name!='HILICz150_ANT20190824_PRD_EMA_Unlab_POS_20201116_506489_WHv1';

DELETE atlases_compound_identifications FROM atlases_compound_identifications LEFT JOIN atlases ON atlases.unique_id=atlases_compound_identifications.source_id WHERE atlases.unique_id is null;

DELETE compoundidentifications FROM compoundidentifications LEFT JOIN atlases_compound_identifications AS aci ON aci.target_id=compoundidentifications.unique_id WHERE aci.target_id is null;

DELETE compoundidentifications_compound FROM compoundidentifications_compound LEFT JOIN compoundidentifications AS ci  ON ci.unique_id=compoundidentifications_compound.head_id WHERE ci.unique_id is null;

DELETE compounds FROM compounds LEFT JOIN compoundidentifications_compound AS cic ON compounds.head_id=cic.target_id WHERE cic.target_id is null;

Largest tables after above DELETE commands:
SELECT CONCAT(table_schema, '.', table_name),
       CONCAT(ROUND(table_rows / 1000000, 2), 'M')                                    rows,
       CONCAT(ROUND(data_length / ( 1024 * 1024 * 1024 ), 2), 'G')                    DATA,
       CONCAT(ROUND(index_length / ( 1024 * 1024 * 1024 ), 2), 'G')                   idx,
       CONCAT(ROUND(( data_length + index_length ) / ( 1024 * 1024 * 1024 ), 2), 'G') total_size,
       ROUND(index_length / data_length, 2)                                           idxfrac
FROM   information_schema.TABLES
ORDER  BY data_length + index_length DESC
LIMIT  10;
+--------------------------------------------------+-------+-------+-------+------------+---------+
| CONCAT(table_schema, '.', table_name)            | rows  | DATA  | idx   | total_size | idxfrac |
+--------------------------------------------------+-------+-------+-------+------------+---------+
| meta_atlas.compounds                             | 0.00M | 0.88G | 0.05G | 0.93G      |    0.05 |
| meta_atlas.lcmsruns                              | 0.34M | 0.31G | 0.25G | 0.56G      |    0.79 |
| meta_atlas.compoundidentifications_rt_references | 0.65M | 0.09G | 0.09G | 0.18G      |    0.96 |
| meta_atlas.compoundidentifications_compound      | 0.00M | 0.07G | 0.08G | 0.14G      |    1.18 |
| meta_atlas.rtreferences                          | 0.68M | 0.12G | 0.00G | 0.12G      |    0.00 |
| meta_atlas.compoundidentifications               | 0.00M | 0.10G | 0.02G | 0.12G      |    0.21 |
| meta_atlas.compoundidentifications_mz_references | 0.65M | 0.09G | 0.00G | 0.09G      |    0.00 |
| meta_atlas.mzreferences                          | 0.49M | 0.08G | 0.00G | 0.08G      |    0.00 |
| meta_atlas.atlases_compound_identifications      | 0.00M | 0.03G | 0.00G | 0.03G      |    0.00 |
| meta_atlas.mzintensitypairs                      | 0.22M | 0.03G | 0.00G | 0.03G      |    0.00 |
+--------------------------------------------------+-------+-------+-------+------------+---------+


DELETE compoundidentifications_rt_references FROM compoundidentifications_rt_references LEFT JOIN compoundidentifications AS ci  ON ci.unique_id=compoundidentifications_rt_references.head_id WHERE ci.unique_id is null;

DELETE rtreferences FROM rtreferences LEFT JOIN compoundidentifications_rt_references AS cirr ON rtreferences.head_id=cirr.target_id WHERE cirr.target_id is null;

DELETE compoundidentifications_mz_references FROM compoundidentifications_mz_references LEFT JOIN compoundidentifications AS ci  ON ci.unique_id=compoundidentifications_mz_references.head_id WHERE ci.unique_id is null;

DELETE mzreferences FROM mzreferences LEFT JOIN compoundidentifications_mz_references AS cimr ON mzreferences.head_id=cimr.target_id WHERE cimr.target_id is null;

# this leaves 8 rows behind, 4 from bpb and 4 from wjholtz...
DELETE FROM lcmsruns WHERE hdf5_file not in
('/project/projectdirs/metatlas/raw_data/akuftin/20201116_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530/20201117_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530_POS_MSMS_76-PS-73_Heated-organic-soil-Oct-28y_E_Rg70to1050-CE205060-WaterExt-S1_Run258.h5', 
'/project/projectdirs/metatlas/raw_data/akuftin/20201116_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530/20201117_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530_POS_MSMS_80-PS-77_Heated-organic-soil-Oct-13y_D_Rg70to1050-CE205060-WaterExt-S1_Run197.h5',
'/project/projectdirs/metatlas/raw_data/akuftin/20201116_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530/20201117_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530_POS_MSMS_83-PS-80_Heated-organic-soil-Oct-13y_E_Rg70to1050-CE205060-WaterExt-S1_Run264.h5',
'/project/projectdirs/metatlas/raw_data/akuftin/20201116_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530/20201117_JGI-AK_LH_506489_SoilWarm_final_QE-HF_HILICZ_USHXG01530_POS_MSMS_35-PS-35_Heated-organic-soil-July-13y_E_Rg70to1050-CE205060-WaterExt-S1_Run243.h5');


+---------------------------------------------------+-------+-------+-------+------------+---------+
| CONCAT(table_schema, '.', table_name)             | rows  | DATA  | idx   | total_size | idxfrac |
+---------------------------------------------------+-------+-------+-------+------------+---------+
| meta_atlas.compounds                              | 0.00M | 0.83G | 0.04G | 0.88G      |    0.05 |
| meta_atlas.lcmsruns                               | 0.00M | 0.31G | 0.25G | 0.55G      |    0.80 |
| meta_atlas.rtreferences                           | 0.00M | 0.17G | 0.00G | 0.17G      |    0.00 |
| meta_atlas.compoundidentifications_rt_references  | 0.00M | 0.08G | 0.08G | 0.16G      |    1.04 |
| meta_atlas.compoundidentifications_compound       | 0.00M | 0.07G | 0.08G | 0.14G      |    1.16 |
| meta_atlas.compoundidentifications                | 0.00M | 0.10G | 0.02G | 0.13G      |    0.22 |
| meta_atlas.compoundidentifications_mz_references  | 0.00M | 0.09G | 0.00G | 0.09G      |    0.00 |
| meta_atlas.mzreferences                           | 0.00M | 0.04G | 0.00G | 0.04G      |    0.00 |
| meta_atlas.mzintensitypairs                       | 0.22M | 0.03G | 0.00G | 0.03G      |    0.00 |
| meta_atlas.fragmentationreferences_mz_intensities | 0.21M | 0.03G | 0.00G | 0.03G      |    0.00 |
+---------------------------------------------------+-------+-------+-------+------------+---------+

uncompressed dump now down to 98 MB

+-----------------------------------------+
| Tables_in_meta_atlas                    |
+-----------------------------------------+
| Compounds                               |
| Group                                   |
| atlases                                 |
| atlases_compound_identifications        |
| compoundidentifications                 |
| compoundidentifications_compound        |
| compoundidentifications_frag_references |
| compoundidentifications_mz_references   |
| compoundidentifications_references      |
| compoundidentifications_rt_references   |
| compounds                               |
| fragmentationreferences                 |
| fragmentationreferences_mz_intensities  |
| functionalsets                          |
| group                                   |
| groups                                  |
| groups_items                            |
| identificationgrades                    |
| intensityreferences                     |
| lcmsruns                                |
| methods                                 |
| mzintensitypairs                        |
| mzreferences                            |
| rtreferences                            |
| samples                                 |
+-----------------------------------------+
Compounds to keep
51
52
53
55
56
60

SELECT unique_id from compounds where chebi_id in ('CHEBI:17256', 'CHEBI:16708', 'CHEBI:16708', 'CHEBI:48517///CHEBI:17712', 'CHEBI:30959///CHEBI:17405', 'CHEBI:16335')

SELECT COUNT(*)
FROM compounds
JOIN compoundidentifications_compound
ON compoundidentifications_compound.target_id=compounds.unique_id
JOIN atlases_compound_identifications
ON compoundidentifications_compound.head_id=atlases_compound_identifications.target_id
WHERE compounds.chebi_id in ('CHEBI:17256', 'CHEBI:16708', 'CHEBI:16708', 'CHEBI:48517///CHEBI:17712', 'CHEBI:30959///CHEBI:17405', 'CHEBI:16335');

SELECT atlases_compound_identifications.id
FROM compoundidentifications_compound
LEFT JOIN atlases_compound_identifications
ON compoundidentifications_compound.head_id=atlases_compound_identifications.target_id
LEFT JOIN compounds
ON compoundidentifications_compound.target_id=compounds.unique_id
WHERE compounds.chebi_id in ('CHEBI:17256', 'CHEBI:16708', 'CHEBI:16708', 'CHEBI:48517///CHEBI:17712', 'CHEBI:30959///CHEBI:17405', 'CHEBI:16335');

+--------+
| id     |
+--------+
| 519622 |
| 519623 |
| 519624 |
| 519626 |
| 519627 |
| 519631 |
+--------+

DELETE FROM atlases_compound_identifications 
WHERE id not in (519622, 519623, 519624, 519626, 519627, 519631);


Need to add to DB:
UPDATE atlases SET name='HILICz150_ANT20190824_PRD_EMA_Unlab_POS_20201116_506489_root0' WHERE unique_id='75a2f59ada644cfd8e743d8706b91047';

UPDATE atlases SET username='root' WHERE unique_id='75a2f59ada644cfd8e743d8706b91047';


pip install mysql-to-sqlite3
mysql2sqlite -f meta_atlas.sqlite3 -d meta_atlas -u root -p mypw -h metatlas-atlasdb

